#+title: Grb2
#+description: grub2

* intro
O principal arquivo de configuração do GRUB2 é o */boot/grub/grub.cfg*, porém este arquivo não deve ser editado diretamente.

As edições devem ser realizadas nos scripts presentes em */etc/grub.d*, ou através do arquivos */etc/default/grub*.

Cada script dentro do diretório */etc/grub.d* possui uma finalidade, conforme a descrição abaixo. Esses scripts atualizam o grub.cfg através do comando *update-grub* ou *update-grub2*

* scripts

*00_header* -> configura parâmetros iniciais, configurações de vídeo, opção padrão, também importa preferências armazenadas do arquivo */etc/default/grub*.

*05_debian_theme* -> configura o background, text color, etcc ...

*10_linux* -> identifica os kernels no dispositivo raiz para o sistema operacional em uso e cria entradas de menu para esses itens. Isso inclui a opção no modo de recuperação.

*20_linux_xen* -> identifica os kernels do hypervisor Xen instalados no sitema em uso e cria entradas de menu para esse item

*30_os-prober* -> script que busa pelos sistemas operacionais disponíveis e coloca os resultados no menu grub2

*40_custom* -> pode ser utilizado para adicionar entradas de menu personalizadas que serão inseridas no */boot/grub/grub.cfg* após a execução do comando *update-grub*

Nas distribuições *RedHat/CentOS versão7* o comando *update-grub2* não existe, nesse caso os comandos utilizados são *grub-mkconfig* ou *grub2-mkconfig*
#+begin_src sh
grub2-mkconfig -o /boot/grub2/grub.cfg
#+end_src

* /etc/default/grub

Além dos scripts, uma saída para edição é o arquivo */etc/default/grub*. Sua organização é mais simples, o que facilita a criação de entradas e configurações.

As principais opções do arquivo */etc/default/grub* são ->

*GRUB_DEFAULT* -> configura a entrada default pela posição ou pelo nome definido na opção menuentry do aruqivo grub.cfg.

 * 0
 * 1

*GRUB_TIMEOUT* -> configura o tempo em segundos que o menu fica aberto augardando a escolhe o sitema operacional que será iniciado

*GRUB_HIDDEN_TIMEOUT* -> quantos segundos aguardar sem exibir o menu do grub, até que a opção padrão do menu seja escolhida automaticamente. nenhum menu é apresentado a menos que o usuário aperte a tecla ESC

*GRUB_CMDLINE_LINUX* -> opção que define os parâmetros passados para o kernel linux do sistema operacional, nesta opção os parâmetros serão usados tanto no modo normal(default) quanto no modo de recuperação.

*GRUB_CMDLINE_LINUX_DEFAULT* -> opção que define os parâmetros passados para o kernel linux do sitema operacional, nesta opção os parâmetros serão usados somente no modo default

* grub2 recover

*grub-install*
*grub2-install*

#+begin_src sh
mount /dev/sda1/mnt
#+end_src

grub
#+begin_src sh
grub-install --root-directory=/mnt /dev/sda
#+end_src

grub2
#+begin_src sh
grub2-install --boot-directory=/mnt /dev/sda
#+end_src
